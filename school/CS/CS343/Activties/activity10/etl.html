<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ETL Pipeline</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <div class="container my-5">
        <h1 class="mb-4">ETL Pipeline Demo</h1>

        <!-- Extract Section -->
        <div class="card mb-4">
            <div class="card-header">
                <h2 class="h4 mb-0">Extract</h2>
            </div>
            <div class="card-body">
                <button id="extractButton" class="btn btn-primary mb-3">Extract HTML</button>
                <textarea id="extractOutput" class="form-control" rows="6" readonly></textarea>
            </div>
        </div>

        <!-- Transform Section -->
        <div class="card mb-4">
            <div class="card-header">
                <h2 class="h4 mb-0">Transform</h2>
            </div>
            <div class="card-body">
                <label for="transformInput" class="form-label">HTML Input:</label>
                <textarea id="transformInput" class="form-control mb-3" rows="4"
                    placeholder="Paste HTML from Extract step here"></textarea>
                <button id="transformButton" class="btn btn-primary mb-3">Transform to JSON</button>
                <label for="transformOutput" class="form-label">JSON Output:</label>
                <textarea id="transformOutput" class="form-control" rows="6" readonly></textarea>
            </div>
        </div>

        <!-- Load Section -->
        <div class="card mb-4">
            <div class="card-header">
                <h2 class="h4 mb-0">Load</h2>
            </div>
            <div class="card-body">
                <label for="loadInput" class="form-label">JSON Input:</label>
                <textarea id="loadInput" class="form-control mb-3" rows="4"
                    placeholder="Paste JSON from Transform step here"></textarea>
                <button id="loadButton" class="btn btn-primary mb-3">Load to localStorage</button>
            </div>
        </div>

        <!-- Display Section -->
        <div class="card mb-4">
            <div class="card-header">
                <h2 class="h4 mb-0">Display</h2>
            </div>
            <div class="card-body">
                <button id="displayButton" class="btn btn-success mb-3">Load data from localStorage</button>

                <select id="countrySelect" class="form-select mb-3">
                    <option value="">Data will be displayed here...</option>
                </select>

                <div id="countryDetails" class="alert alert-info" style="display: none;">
                    <h5>Country Details</h5>
                    <p><strong>Name:</strong> <span id="countryName"></span></p>
                    <p><strong>Capital:</strong> <span id="countryCapital"></span></p>
                    <p><strong>Population:</strong> <span id="countryPopulation"></span></p>
                    <p><strong>Area:</strong> <span id="countryArea"></span> kmÂ²</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Display: Load data from localStorage and populate dropdown
        document.getElementById('displayButton').addEventListener('click', function () {
            populateDropdown();
        });

        document.getElementById('countrySelect').addEventListener('change', function () {
            if (this.value !== '') {
                displayCountryDetails(parseInt(this.value));
            } else {
                document.getElementById('countryDetails').style.display = 'none';
            }
        });

        function populateDropdown() {
            const stored = localStorage.getItem('countries');
            if (!stored) {
                alert('No data found in localStorage. Please load data first.');
                return;
            }

            const countries = JSON.parse(stored);
            const select = document.getElementById('countrySelect');

            // Clear existing options
            select.innerHTML = '';

            countries.forEach((country, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = country.name;
                select.appendChild(option);
            });

            // Auto-select the first country
            if (countries.length > 0) {
                select.value = '0';
                displayCountryDetails(0);
            }
        }

        function displayCountryDetails(index) {
            const stored = localStorage.getItem('countries');
            if (!stored) return;

            const countries = JSON.parse(stored);
            const country = countries[index];

            document.getElementById('countryName').textContent = country.name;
            document.getElementById('countryCapital').textContent = country.capital;
            document.getElementById('countryPopulation').textContent = country.population;
            document.getElementById('countryArea').textContent = country.area;
            document.getElementById('countryDetails').style.display = 'block';
        }

        // Get DOM elements
        const extractButton = document.getElementById('extractButton');
        const extractOutput = document.getElementById('extractOutput');

        const transformButton = document.getElementById('transformButton');
        const transformInput = document.getElementById('transformInput');
        const transformOutput = document.getElementById('transformOutput');

        const loadButton = document.getElementById('loadButton');
        const loadInput = document.getElementById('loadInput');

        // Extract: Fetch HTML from the website and display in extractOutput
        extractButton.addEventListener('click', async function () {
            const response = await fetch('https://cors-anywhere.com/https://www.scrapethissite.com/pages/simple/');
            const html = await response.text();
            extractOutput.value = html;
        });

        // Transform: Parse HTML and convert to JSON, display in transformOutput
        transformButton.addEventListener('click', function () {
            const html = transformInput.value;
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const countryDivs = doc.querySelectorAll('.country');
            const countries = [];

            countryDivs.forEach(countryDiv => {
                const name = countryDiv.querySelector('.country-name').textContent.trim();
                const capital = countryDiv.querySelector('.country-capital').textContent.trim();
                const population = parseInt(countryDiv.querySelector('.country-population').textContent.trim());
                const area = parseFloat(countryDiv.querySelector('.country-area').textContent.trim());

                countries.push({
                    name: name,
                    capital: capital,
                    population: population,
                    area: area
                });
            });

            const jsonString = JSON.stringify(countries, null, 2);
            transformOutput.value = jsonString;
        });

        // Load: Store JSON data in localStorage under the key 'countries'
        loadButton.addEventListener('click', function () {
            const jsonString = loadInput.value;
            localStorage.setItem('countries', jsonString);
            alert('Data loaded into local storage!');
        });
    </script>
</body>

</html>