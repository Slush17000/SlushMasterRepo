<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ETL Pipeline</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <div class="container my-5">
        <h1 class="mb-4">ETL Pipeline Demo</h1>

        <!-- Extract Section -->
        <div class="card mb-4">
            <div class="card-header">
                <h2 class="h4 mb-0">Extract</h2>
            </div>
            <div class="card-body">
                <div class="d-flex justify-content-left">
                    <button id="extractButton" class="btn btn-primary mb-3">Extract HTML</button>
                    <button id="extractTextButton" class="btn btn-secondary mb-3 ms-1">Extract Text</button>
                    <button id="copyExtractButton" class="btn btn-info mb-3 ms-auto">
                        Copy
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            class="bi bi-copy" viewBox="0 0 16 16">
                            <path fill-rule="evenodd"
                                d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zM2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1z" />
                        </svg>
                    </button></svg>
                </div>
                <textarea id="extractOutput" class="form-control" rows="6" readonly></textarea>
            </div>
        </div>

        <!-- Transform Section -->
        <div class="card mb-4">
            <div class="card-header">
                <h2 class="h4 mb-0">Transform</h2>
            </div>
            <div class="card-body">
                <label for="transformInput" class="form-label">Data Input:</label>
                <textarea id="transformInput" class="form-control mb-3" rows="4"
                    placeholder="Paste data from Extract step here"></textarea>
                <div class="d-flex justify-content-left">
                    <button id="transformButton" class="btn btn-primary mb-3">HTML to JSON</button>
                    <button id="transformTextButton" class="btn btn-secondary mb-3 ms-1">Text to JSON</button>
                </div>
                <div class="d-flex justify-content-left">
                    <label for="transformOutput" class="form-label mt-3">JSON Output:</label>
                    <button id="copyTransformButton" class="btn btn-info mb-3 ms-auto">
                        Copy
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            class="bi bi-copy" viewBox="0 0 16 16">
                            <path fill-rule="evenodd"
                                d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zM2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1z" />
                        </svg>
                </div>
                <textarea id="transformOutput" class="form-control" rows="6" readonly></textarea>
            </div>
        </div>

        <!-- Load Section -->
        <div class="card mb-4">
            <div class="card-header">
                <h2 class="h4 mb-0">Load</h2>
            </div>
            <div class="card-body">
                <label for="loadInput" class="form-label">JSON Input:</label>
                <textarea id="loadInput" class="form-control mb-3" rows="4"
                    placeholder="Paste JSON from Transform step here"></textarea>
                <button id="loadButton" class="btn btn-primary mb-3">Load to localStorage</button>
            </div>
        </div>

        <!-- Display Section -->
        <div class="card mb-4">
            <div class="card-header">
                <h2 class="h4 mb-0">Display</h2>
            </div>
            <div class="card-body">
                <button id="displayButton" class="btn btn-success mb-3">Load data from localStorage</button>

                <select id="countrySelect" class="form-select mb-3">
                    <option value="">Data will be displayed here...</option>
                </select>

                <div id="countryDetails" class="alert alert-info" style="display: none;">
                    <h5>Country Details</h5>
                    <p><strong>Name:</strong> <span id="countryName"></span></p>
                    <p><strong>Capital:</strong> <span id="countryCapital"></span></p>
                    <p><strong>Population:</strong> <span id="countryPopulation"></span></p>
                    <p><strong>Area:</strong> <span id="countryArea"></span> kmÂ²</p>
                </div>
            </div>
        </div>
    </div>

    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="copyToast" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive"
            aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body">
                    Copied to clipboard.
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Display: Load data from localStorage and populate dropdown
        document.getElementById('displayButton').addEventListener('click', function () {
            populateDropdown();
        });

        document.getElementById('countrySelect').addEventListener('change', function () {
            if (this.value !== '') {
                displayCountryDetails(parseInt(this.value));
            } else {
                document.getElementById('countryDetails').style.display = 'none';
            }
        });

        // Populate dropdown from localStorage
        function populateDropdown() {
            const stored = localStorage.getItem('countries');
            if (!stored) {
                alert('No data found in localStorage. Please load data first.');
                return;
            }

            const countries = JSON.parse(stored);
            const select = document.getElementById('countrySelect');

            // Clear existing options
            select.innerHTML = '';

            countries.forEach((country, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = country.name;
                select.appendChild(option);
            });

            // Auto-select the first country
            if (countries.length > 0) {
                select.value = '0';
                displayCountryDetails(0);
            }
        }

        // Display selected country details
        function displayCountryDetails(index) {
            const stored = localStorage.getItem('countries');
            if (!stored) return;

            const countries = JSON.parse(stored);
            const country = countries[index];

            document.getElementById('countryName').textContent = country.name;
            document.getElementById('countryCapital').textContent = country.capital;
            document.getElementById('countryPopulation').textContent = country.population;
            document.getElementById('countryArea').textContent = country.area;
            document.getElementById('countryDetails').style.display = 'block';
        }

        // Get DOM elements
        const extractButton = document.getElementById('extractButton');
        const extractTextButton = document.getElementById('extractTextButton');
        const extractOutput = document.getElementById('extractOutput');
        const copyExtractButton = document.getElementById('copyExtractButton');

        const transformButton = document.getElementById('transformButton');
        const transformTextButton = document.getElementById('transformTextButton');
        const transformInput = document.getElementById('transformInput');
        const transformOutput = document.getElementById('transformOutput');
        const copyTransformButton = document.getElementById('copyTransformButton');

        const loadButton = document.getElementById('loadButton');
        const loadInput = document.getElementById('loadInput');

        const toastEl = document.getElementById('copyToast');
        const toast = new bootstrap.Toast(toastEl);

        // Copy buttons
        copyExtractButton.addEventListener('click', async function () {
            await navigator.clipboard.writeText(extractOutput.value);
            toast.show();
        });

        copyTransformButton.addEventListener('click', async function () {
            await navigator.clipboard.writeText(transformOutput.value);
            toast.show();
        });

        // Extract: Fetch HTML from the website and display in extractOutput
        extractButton.addEventListener('click', async function () {
            const response = await fetch('https://cors-anywhere.com/https://www.scrapethissite.com/pages/simple/');
            extractOutput.value = await response.text();
        });

        extractTextButton.addEventListener('click', async function () {
            const response = await fetch('https://w3.cs.jmu.edu/wangid/cs343/f25/act/data-engineering/countries.txt');
            extractOutput.value = await response.text();
        });

        // Transform: Parse HTML and convert to JSON, display in transformOutput
        transformButton.addEventListener('click', function () {
            const html = transformInput.value;

            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');

            const countries = [];
            const countryDivs = doc.querySelectorAll('.country');

            countryDivs.forEach(div => {
                const country = {
                    name: div.querySelector('.country-name')?.textContent.trim(),
                    capital: div.querySelector('.country-capital')?.textContent.trim(),
                    population: parseInt(div.querySelector('.country-population')?.textContent.trim()),
                    area: parseFloat(div.querySelector('.country-area')?.textContent.trim())
                };
                countries.push(country);
            });

            const jsonData = JSON.stringify(countries, null, 2);
            transformOutput.value = jsonData;
        });

        transformTextButton.addEventListener('click', function () {
            const text = transformInput.value;
            const countries = [];

            // Use RegEx to parse text input and extract country data
            const regex = /Country: (.+?); Capital: (.+?); Population: (\d+); Area: ([\d.]+)/g;
            const matches = text.matchAll(regex);

            for (const match of matches) {
                const country = {
                    name: match[1].trim(),
                    capital: match[2].trim(),
                    population: parseInt(match[3]),
                    area: parseFloat(match[4])
                };
                countries.push(country);
            }

            const jsonData = JSON.stringify(countries, null, 2);
            transformOutput.value = jsonData;
        });

        // Load: Store JSON data in localStorage under the key 'countries'
        loadButton.addEventListener('click', function () {
            const jsonString = loadInput.value;

            const countries = JSON.parse(jsonString);
            localStorage.setItem('countries', JSON.stringify(countries));
            alert('Data loaded to localStorage successfully!');
        });
    </script>
</body>

</html>